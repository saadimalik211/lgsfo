generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  name      String
  email     String    @unique
  phone     String?
  role      UserRole  @default(CUSTOMER)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]

  @@map("users")
}

model Booking {
  id              String        @id @default(cuid())
  userId          String?
  pickup          String
  dropoff         String
  datetime        DateTime
  passengers      Int
  luggage         Int           @default(0)
  extras          Json?
  rideType        RideType      @default(TESLA_MODEL_Y)
  distanceKm      Float?
  durationMin     Int?
  priceCents      Int
  status          BookingStatus @default(PENDING)
  // Customer information (stored locally for guest bookings)
  customerName    String?
  customerEmail   String?
  customerPhone   String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  user            User?         @relation(fields: [userId], references: [id])
  payments        Payment[]

  @@map("bookings")
}

model Payment {
  id                      String        @id @default(cuid())
  bookingId               String
  stripePaymentId         String?
  stripePaymentIntentId   String?       // For authorization holds
  amountCents             Int
  currency                String        @default("USD")
  status                  PaymentStatus @default(REQUIRES_PAYMENT_METHOD)
  paymentMethod           PaymentMethod @default(STRIPE)
  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
  booking                 Booking       @relation(fields: [bookingId], references: [id])

  @@map("payments")
}

enum UserRole {
  CUSTOMER
  ADMIN
  DRIVER
}

enum RideType {
  TESLA_MODEL_Y
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  REQUIRES_PAYMENT_METHOD
  AUTHORIZED
  SUCCEEDED
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentMethod {
  STRIPE
  CASH
  VENMO
  ZELLE
  OTHER
}
